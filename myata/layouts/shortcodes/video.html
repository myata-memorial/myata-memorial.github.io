{{- $raw := "" -}}
{{- if .IsNamedParams -}}
  {{- $raw = default "" (.Get "src") -}}
{{- else -}}
  {{- $raw = default "" (.Get 0) -}}
{{- end -}}

{{- $parts := split (printf "%v" $raw) "|" -}}
{{- $src := "" -}}
{{- if gt (len $parts) 0 -}}
  {{- $src = index $parts 0 -}}
{{- end -}}
{{- $caption := "" -}}
{{- if gt (len $parts) 1 -}}
  {{- $caption = index $parts 1 -}}
{{- end -}}

{{- if not $src -}}
  {{- errorf "video shortcode: src is required (%s)" .Position -}}
{{- end -}}

<figure style="margin: 1rem 0 1.25rem;">
  <video controls preload="metadata" playsinline style="width: 100%; border-radius: 8px;" src="{{ $src | relURL }}" title="{{ $caption }}">
    Your browser does not support the video tag.
  </video>
  {{- if $caption -}}
    <figcaption style="margin-top: 0.5rem; opacity: 0.8; font-size: 0.8em; text-align:center;">{{ $caption }}</figcaption>
  {{- end -}}
</figure>
